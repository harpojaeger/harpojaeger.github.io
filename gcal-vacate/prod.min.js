function checkAuth(){console.log('Authorizing.'),gapi.auth.authorize({client_id:CLIENT_ID,scope:SCOPES.join(' '),immediate:!0},handleAuthResult)}function handleAuthResult(e){e&&!e.error?(authController.div.hide(),loadCalendarApi()):($('#authorize_button').button({icon:'ui-icon-calendar'}),containerController.div.show(),authController.div.show())}function handleAuthClick(e){return gapi.auth.authorize({client_id:CLIENT_ID,scope:SCOPES,immediate:!1},handleAuthResult),!1}function loadCalendarApi(){gapi.client.load('calendar','v3',list_calendars)}function list_calendars(){console.log('Listing calendars');var e=gapi.client.calendar.calendarList.list({minAccessRole:'writer'});e.execute(function(e){var t=e.items;for(calendar_select=$('#calendar-select'),i=0;i<t.length;i++){var n=t[i];new Calendar(n)}console.log('Retrieved '+t.length+' calendars.'),$('#calendar-select').coloredMenu({renderItem:coloredItem}),$('#submit').button({icon:'ui-icon-search'}).click(prepareSearch),containerController.div.show(),searchController.div.show()}),$.widget('custom.coloredMenu',$.ui.selectmenu,{options:{renderItem:null},_renderItem:function(e,t){return $.isFunction(this.options.renderItem)?this.options.renderItem(e,t):this._super(e,t)}}),coloredItem=function(e,t){var n=$('<div>'),i=$('<div>').addClass('cal-select-color-box').css({'background-color':t.element.data('backgroundColor')}).html('&nbsp;&nbsp;&nbsp;&nbsp;'),a=$('<a>').html(t.label);$(n).append(i,a);var o=$('<li>').append(n);return $(o).appendTo(e)}}function Calendar(e){$('<option>').text(e.summary).attr('value',e.id).data({backgroundColor:e.backgroundColor,foregroundColor:e.foregroundColor}).appendTo(calendar_select)}function BaseEvent(e,t){function n(e){var t=$(e).data('eventObject').instances_resp,n=($(e).data('eventObject').baseEventData,t.items);for(i=0;i<n.length;i++){var a=n[i];new Instance(a,l)}}this.baseEventData=e,this.instances_resp=t;var a=$('<li>'),o=$('<span>').addClass('event-list-triangle ui-icon ui-icon-triangle-1-e'),s=$('<div>').addClass('event-instances-div'),l=$('<ul>').addClass('instances-ul').appendTo(s),c=$('<div>').addClass('event-deletion-controls'),r=$('<span>').addClass('action-link instance-select-all').text('all').click(function(){console.log('Select all instances for deletion.'),$(a).find('span.ui-icon-minus').click()}),d=$('<span>').addClass('action-link instance-select-none').text('none').click(function(){console.log('Deselect all instances for deletion.'),$(a).find('span.ui-icon-check').click()}),u=($('<span>').addClass('instance-selection').append('select (',r,' | ',d,')').appendTo(c),$('<span>').addClass('action-link').text('delete').prepend($('<span>').addClass('ui-icon ui-icon-trash').html('&nbsp;')).appendTo(c).click(function(){displayDeleteConfirmation(a)}),rrulestr(this.baseEventData.recurrence[0])),h=u.toText(),v=$('<span>').text(this.baseEventData.summary).prepend(o).addClass('action-link').click(function(){$('div.event-instances-div').not($(this).siblings('div.event-instances-div')).slideUp(),$('span.event-list-triangle').not(o).removeClass('ui-icon-triangle-1-s').addClass('ui-icon-triangle-1-e'),$(o).toggleClass('ui-icon-triangle-1-e ui-icon-triangle-1-s'),$(s).slideToggle(),$('#events-div ul li div.event-deletion-controls').not(c).fadeOut(),$(c).fadeToggle().css('display','inline')}).attr('title',h).tooltip({show:{duration:500,delay:500},tooltipClass:'rrule-tooltip',track:!0});$(a).data('eventObject',this).append(v,c,s).appendTo(eventsUl),n(a)}function Instance(e,t){this.id=e.id,this.recurringEventId=e.recurringEventId,this.summary=e.summary,this.start=e.start,this.end=e.end;var n=e.start.dateTime;n?(parsedDate=Date.parse(n),n=parsedDate.toString('ddd MMM dd, h:mm tt')):(n=e.start.date,parsedDate=Date.parse(n),n=parsedDate.toString('ddd MMM dd'));var i=$('<li>'),a=$('<input type="checkbox" class="deleteThisInstanceCheckbox" checked>').change(function(){$(i).data('shouldDelete',$(this).prop('checked')),console.log($(i).data('id')+' has delete value: '+$(i).data('shouldDelete'))}).attr('id',this.id),o=$('<label>').attr('for',this.id).click(function(){$(this).children('span.instance-deletion-checkbox-label').toggleClass('ui-icon-check ui-icon-minus')}).text(e.summary+' ('+n+')').prepend($('<span>').addClass('instance-deletion-checkbox-label ui-icon ui-icon-check'));$(i).append(a,o).addClass('instance').appendTo(t).data({id:this.id,recurringEventId:this.recurringEventId,calendarId:calendar_ID,shouldDelete:!0})}function displayDeleteConfirmation(e){$('#alert_div').attr('title','Delete all instances?').text('Are you sure you want to delete all selected instances of this event?  This cannot be undone.').dialog({modal:!0,draggable:!1,resizable:!1,position:{my:'top',at:'center',of:window},buttons:[{text:'No',icon:'ui-icon-circle-close',click:function(){$(this).dialog('close'),console.log('Clicked no.')}},{text:'Yes',icon:'ui-icon-circle-check',click:function(){$(this).dialog('close'),console.log('Clicked yes'),delete_all_instances(e)}}]})}function delete_all_instances(e){console.log('Delete all shown instances.');var t=!0,n=gapi.client.newBatch();$(e).find('li.instance').each(function(e){var i=$(this).data();if(i.shouldDelete){var a=gapi.client.calendar.events.delete({calendarId:i.calendarId,eventId:i.id});n.add(a,{id:i.id})}else console.log('Skipping '+i.id),t=!1}),n.then(function(e){console.log('Batch status is '+e.status);for(var n in e.result){thisResult=e.result[n],thisStatus=thisResult.status;var i=thisStatus+' '+n+' ',a=!0;switch(thisResult.status){case 410:i+='Event was already deleted.  No worries here!';break;case 401:case 403:i+='Authorization problem.  Try refreshing the page.',a=!1,t=!1;break;case 404:case 409:i+='Resource changed or not found.  Run your search again.',a=!1,t=!1}console.log(i)}a&&$('#'+n).parent().slideUp(function(){$(this).remove()})},function(e){console.log('Big error.  Try refreshing the page.'),console.log(e)}),t&&$(e).slideUp(function(){$(this).remove()})}function prepareSearch(){var e=$('#start').val(),t=$('#end').val();calendar_ID=$('#calendar-select').val(),$('#calendar-select').val().length&&e.length&&t.length?(e+='T00:00:00'+timezoneSuffix,t+='T00:00:00'+timezoneSuffix,console.log('Search for repeating events from '+e+' to '+t+' in calendar '+calendar_ID),listUpcomingEvents(e,t),eventsController.div.show(),eventsController.ul.clear()):(console.log('Requisite data not present for search.'),$('#alert_div').attr('title','Error').text('Please choose a calendar and enter both start and end dates.').dialog({modal:!0,draggable:!1,resizable:!1,position:{my:'top',at:'center',of:window},buttons:[{text:'OK',icon:'ui-icon-check',click:function(){$(this).dialog('close')}}]}))}function listUpcomingEvents(e,t){function n(e){var t=function(t){if(t.code)console.log('Error '+t.code+': '+instance_resp.message),console.log(t);else{var n='Found '+t.items.length+' instances of '+e.summary;t.items.length>0?(new BaseEvent(e,t),eventsController.msg.hide()):n+=' - skipping.',console.log(n)}};return t}var a=gapi.client.calendar.events.list({calendarId:calendar_ID,timeMin:e,timeMax:t,showDeleted:!1,singleEvents:!1,maxResults:2500});a.execute(function(e){var t=e.items;if(eventsController.msg.set('No events found.'),eventsController.msg.show(),t.length>0){for(i=0;i<t.length;i++){var a=t[i];if('confirmed'==a.status&&'undefined'!=typeof a.recurrence){var o=gapi.client.calendar.events.instances({calendarId:calendar_ID,eventId:a.id,timeMin:$('#start').val()+'T00:00:00'+timezoneSuffix,timeMax:$('#end').val()+'T00:00:00'+timezoneSuffix});this_func=n(a),o.execute(this_func)}}eventsController.div.show()}else console.log('No upcoming events found.'),eventsController.ul.clear()})}function calculateTimezone(){var e=new Date;return offset=e.getUTCOffset(),offset.slice(0,3)+':'+offset.slice(3)}function containerController(){containerDiv=$('#container'),this.div={show:function(){$(containerDiv).show()}}}function authController(){authDiv=$('#authorize_div'),this.div={show:function(){$(authDiv).show()},hide:function(){$(authDiv).hide()}}}function eventsController(){eventsTitle=$('#events_title'),eventsUl=$('#events_ul'),eventsDiv=$('#events-div'),eventsMsg=$('#events_msg'),this.title={show:function(){$(eventsTitle).show()},hide:function(){$(eventsTitle).hide()}},this.ul={clear:function(){$(eventsUl).empty()}},this.div={show:function(){$(eventsDiv).show()},hide:function(){$(eventsDiv).hide()},clear:function(){$(eventsDiv).empty()}},this.msg={clear:function(){$(eventsMsg).empty()},set:function(e){$(eventsMsg).text(e)},hide:function(){$(eventsMsg).hide()},show:function(){$(eventsMsg).show()}}}function searchController(){var e=$('#search_div');this.div={show:function(){$(e).show()},hide:function(){$(e).hide()}}}var CLIENT_ID='223934007308-ldle11sd1bl1udh6gaq14d604q5lu4jf.apps.googleusercontent.com',SCOPES=['https://www.googleapis.com/auth/calendar'];$(document).ready(function(){console.log('Document ready.'),timezoneSuffix=calculateTimezone(),containerController=new containerController,eventsController=new eventsController,searchController=new searchController,authController=new authController});var datepickerOptions={dateFormat:'yy-mm-dd',changeMonth:!0,changeYear:!0,showOtherMonths:!0,selectOtherMonths:!0};$(function(){function e(e){var t;try{t=$.datepicker.parseDate(dateFormat,e.value)}catch(e){t=null}return t}from=$('#start').datepicker(datepickerOptions).on('change',function(){to.datepicker('option','minDate',e(this))}),to=$('#end').datepicker(datepickerOptions).on('change',function(){from.datepicker('option','maxDate',e(this))})});